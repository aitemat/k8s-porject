# Tổng quan
## iSCSI là gì?
`Persistent Volume (PV)` trong Kubernetes là một tài nguyên cấp cao, đại diện cho một phần trữ lượng lưu trữ bên ngoài được cung cấp cho các container trong cluster. PV giúp cho việc quản lý và sử dụng các tài nguyên lưu trữ trở nên dễ dàng và linh hoạt hơn.

`iSCSI` (Internet Small Computer System Interface) là một giao thức lưu trữ cho phép máy chủ kết nối đến các thiết bị lưu trữ thông qua mạng IP. Trong Kubernetes, iSCSI được sử dụng để kết nối đến các thiết bị lưu trữ bên ngoài, chia sẻ các tài nguyên lưu trữ đó với các container trong cluster.

Các bước để sử dụng Persistent Volume với iSCSI trong Kubernetes bao gồm:

- Cấu hình iSCSI target trên máy chủ lưu trữ (storage server).

- Cài đặt iSCSI initiator trên các node trong Kubernetes cluster để kết nối đến iSCSI target.

- Tạo một Persistent Volume (PV) trong Kubernetes cluster để đại diện cho phần trữ lượng lưu trữ bên ngoài được cung cấp thông qua iSCSI. PV có thể được định nghĩa thông qua các thông số như địa chỉ IP của iSCSI target, tên iSCSI target, tên iSCSI phân vùng, dung lượng lưu trữ, và quyền truy cập.

- Tạo một Persistent Volume Claim (PVC) trong Kubernetes cluster để yêu cầu sử dụng một phần hoặc toàn bộ dung lượng của PV.

- Sử dụng PVC trong Pod bằng cách sử dụng đối tượng VolumeClaimTemplate trong file định nghĩa Pod. Khi Pod được tạo, Kubernetes sẽ tự động cung cấp một phiên bản của PV được yêu cầu thông qua PVC.

Khi một container được triển khai trên Kubernetes cluster, Kubernetes sẽ liên kết các PVC được sử dụng trong Pod với PV tương ứng để cung cấp truy cập đến các tài nguyên lưu trữ bên ngoài được cung cấp thông qua iSCSI. Khi container bị xóa hoặc di chuyển, Kubernetes sẽ tự động giải phóng các tài nguyên lưu trữ bên ngoài bằng cách giải phóng các PVC và PV được sử dụng trong Pod. 
## Một số thuật ngữ

+ `iSCSI Target Server`: Server quản lý các thiết bị lưu trữ.

+ `Physical Disk`: Đĩa vật lý. Thông thường 1 iSCSI Target Server phải gắn nhiều đĩa vật lý.

+ `iSCSI Virtual Disk`: Là các đĩa ảo được tạo ra từ 1 Physical Disk.

+ `iSCSI Target`: Là tập hợp gồm 1 hoặc nhiều iSCSI Virtual Disk để các Server có thể kết nối đến và sử dụng.

+ `iSCSI Initiator (Access Server)`: là 1 Server đảm nhận một dịch vụ bất kỳ mà nó sẽ kết nối tới iSCSI Target để sử dụng hệ thống đĩa.

+ `Storage Pool`: là tập hợp các iSCSI Virtual Disk đã kết nối được từ iSCSI Target mà chúng ta muốn sử dụng.

+ `Virtual Disk`: là 1 đĩa cứng ảo, dùng để xác định mục đích sử dụng.

+ `Volume`: là ổ đĩa luận lý được gán ký tự đĩa và được sử dụng để lưu trữ dữ liệu cho server
## Các bước triển khai
- Cài đặt iSCSI Target Server

- Tạo iSCSI Virtual Disk

- Kết nối đến iSCSI Target

- Tạo Storage Pool

- Tạo Virtual Disk

- Tạo Volume

- Kiểm tra
# 1. Requirement
`Master 1`: Docker + Master node (RAM >=3GB + CPU 4 + Disk >=30GB: 45.117.80.52 - Ubuntu 20.04 - hostname: k8s-master1  
`Master 2`: Docker + Master node (RAM >=3GB + CPU 4 + Disk >=30GB: 103.101.162.200 - Ubuntu 20.04 - hostname: k8s-master2  
`Master 3`: Docker + Master node (RAM >=3GB + CPU 4 + Disk >=30GB: 45.117.80.150 - Ubuntu 20.04 - hostname: k8s-master3- Haproxy  
`Master 4`: Window server 2022 (RAM >=3GB + CPU 4 + Disk >=40GB): 103.101.162.145 - iSCSI server   
`Node 1`: Docker + Node worker 1 ( RAM 2GB + CPU 1 + Disk 20GB): 103.101.163.72 - Ubuntu 20.04 - hostname: k8s-nodew1  
`Node 2`: Docker + Node worker 2 ( RAM 2GB + CPU 1 + Disk 20GB): 103.101.162.20 - Ubuntu 20.04 - hostname: k8s-nodew1  

# 2. Cấu hình iSCSI target trên window server 2022 (Master 4)

