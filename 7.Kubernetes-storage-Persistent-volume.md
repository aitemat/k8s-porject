# Kubernetes Persistent Storage là gì?
Kubernetes Persistent Storage cung cấp cho các ứng dụng triển khai trên Kubernetes một cách thuận tiện để yêu cầu và sử dụng tài nguyên lưu trữ. Nếu như các Ephemeral Storage (lưu trữ tạm thời) có thời gian tồn tại là thời gian tồn tại của pod và nó có thể bị mất đi sau khi pod bị xoá hoặc gặp sự cố, vô tình bị tắt, thì các Persistent Storage (lưu trữ liên tục) có thời gian tồn tại độc lập với pod và không bị mất đi khi pod bị xoá hay gặp sự cố. Persistent Storage là điều cần thiết với các ứng dụng quan trọng cần lưu trữ ổn định, bền bỉ vượt xa pod hoặc thậm chí là node mà pod đang chạy.  

Để tạo và sử dụng Persistent Storage, Kubernetes cung cấp cho chúng ta hai loại API resource là PersistentVolume (PV) and PersistentVolumeClaim (PVC). Trên thực tế, Kubernetes hỗ trợ rất nhiều loại volume storage khác nhau và một số các volume thuần vẫn có thể có persistent storage. Tuy nhiên, PV và PVC là rất hữu ích cho việc quản lý tài nguyên lưu trữ cho các dự án lớn. Nó giúp trừu tượng đi các chi tiết cơ sở hạ tầng, có độ phức tạp cao hơn so với chỉ sử dụng volume thuần. Trong phạm vi bài viết này, mình sẽ sùng các bạn có những tìm hiểu cơ bản về PersistentVolume và PersistentVolumeClaim cũng như cách sử dụng chúng nhé.  

<img src="/images/persitent-colume.jpg">  

## PERSISTENT VOLUMES
***PersistentVolume (PV)*** là một phần không gian lưu trữ dữ liệu trong cụm được cấp phát bởi Cluster Admin hoặc được cấp phát linh hoạt. Nó là một loại tài nguyên của của cụm cũng giống như 1 node là tài nguyên của cụm. Các PV này cũng giống như các Volume thuần khác, tuy nhiên nó tồn tại hoàn toàn độc lập với bất kỳ pod nào sử dụng PV. Hiện tại, Kubernetes hỗ trợ rất nhiều các loại PersistentVolume khác nhau được cài đặt dưới dạng plugin như glusterfs, nfs, csi,  

## PERSISTENT VOLUME CLAIM
Một người dùng muốn sử dụng không gian lưu trữ (PV) thì cần tạo một PersistentVolumeClaim (PVC). Nó chính là một yêu cầu sử dụng không gian lưu trữ (yêu cầu sử dụng PV). Thông thường người dùng sẽ tạo một manifest PersistentVolumeClaim, chỉ định số lượng, loại lớp lưu trữ (storage class), yêu cầu các mức tài nguyên CPU, bộ nhớ,… Ngoài ra, PVC còn có thể xác định các chế độ quyền truy cập cụ thể vào vùng lưu trữ (ví dụ như: ReadWriteOnce, ReadOnlyMany or ReadWriteMany. Kubernetes sau đó sẽ dựa vào các thông tin này để tìm và dự trữ dung lượng lưu trữ cần thiết.  
Để hiểu rõ hơn về mối quan hệ giữa PV và PVC, bạn có thể hình dung chúng giống như là node và pod. Nếu như Pod tiêu thụ tài nguyên của node thì ở đây, PVC sẽ tiêu thụ tài nguyên của PV.
     

